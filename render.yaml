services:
  # 快速回補 00:01 UTC
  - type: cron
    name: coinglass-fast-0001
    env: python
    plan: starter
    region: singapore
    schedule: "1 0 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: bash scripts/run_fast.sh
    envVars:
      - key: COINGLASS_API_KEY
        sync: false
      - key: DATABASE_URL           # 需含 sslmode=require
        sync: false
      - key: FAST_DAYS
        value: "4"
      - key: CG_QPM
        value: "60"
      - key: CG_EXLISTS
        value: "Binance,OKX,Bybit"
      - key: CG_EXCHANGES
        value: "Binance"
      - key: CG_COINS
        value: "BTC,ETH,XRP,BNB,SOL,DOGE,ADA"

  # 快速回補 00:10 UTC
  - type: cron
    name: coinglass-fast-0010
    env: python
    plan: starter
    region: singapore
    schedule: "10 0 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: bash scripts/run_fast.sh
    envVars:
      - key: COINGLASS_API_KEY
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: FAST_DAYS
        value: "4"
      - key: CG_QPM
        value: "60"

  # 全量修補 02:20 UTC
  - type: cron
    name: coinglass-full-0220
    env: python
    plan: starter
    region: singapore
    schedule: "20 2 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: bash scripts/run_full.sh
    envVars:
      - key: COINGLASS_API_KEY
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: CG_QPM
        value: "60"

  # 背景 worker，固定 Python 版本
  - type: worker
    name: coinglass-cron
    env: python
    plan: starter
    buildCommand: pip install --upgrade pip && pip install --no-cache-dir -r requirements.txt
    startCommand: bash scripts/run_fast.sh
    envVars:
      - key: PYTHON_VERSION   # 🔑 用環境變數來指定 Python 版本
        value: "3.11"
