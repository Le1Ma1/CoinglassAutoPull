services:
  # 快速回補 00:01 UTC
  - type: cron
    name: coinglass-fast-0001
    env: python
    plan: starter
    region: singapore
    schedule: "1 0 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: bash scripts/run_fast.sh
    envVars:
      - key: SUPABASE_DB_URL
        sync: false
      - key: COINGLASS_API_KEY
        sync: false
      - key: FAST_DAYS
        value: "4"
      - key: CG_QPM
        value: "60"
      - key: CG_EXLISTS
        value: "Binance,OKX,Bybit"
      - key: CG_EXCHANGES
        value: "Binance"
      - key: CG_COINS
        value: "BTC,ETH,XRP,BNB,SOL,DOGE,ADA"
      - key: PYTHON_VERSION
        value: "3.11.9"

  # 快速回補 00:10 UTC
  - type: cron
    name: coinglass-fast-0010
    env: python
    plan: starter
    region: singapore
    schedule: "10 0 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: bash scripts/run_fast.sh
    envVars:
      - key: SUPABASE_DB_URL
        sync: false
      - key: COINGLASS_API_KEY
        sync: false
      - key: FAST_DAYS
        value: "4"
      - key: CG_QPM
        value: "60"
      - key: PYTHON_VERSION
        value: "3.11.9"

  # 全量修補 02:20 UTC
  - type: cron
    name: coinglass-full-0220
    env: python
    plan: starter
    region: singapore
    schedule: "20 2 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: bash scripts/run_full.sh
    envVars:
      - key: SUPABASE_DB_URL
        sync: false
      - key: COINGLASS_API_KEY
        sync: false
      - key: CG_QPM
        value: "60"
      - key: PYTHON_VERSION
        value: "3.11.9"

  # 背景 worker
  - type: worker
    name: coinglass-cron
    env: python
    plan: starter
    buildCommand: pip install --upgrade pip && pip install --no-cache-dir -r requirements.txt
    startCommand: bash scripts/run_fast.sh
    envVars:
      - key: SUPABASE_DB_URL
        sync: false
      - key: PYTHON_VERSION
        value: "3.11.9"

  # 特徵+標籤 00:05 UTC
  - type: cron
    name: features_labels_3d_A
    env: python
    plan: starter
    region: singapore
    schedule: "5 0 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: DAYS=3 python -m src.cli.build_features_labels
    envVars:
      - key: SUPABASE_DB_URL
        sync: false
      - key: PYTHON_VERSION
        value: "3.11.9"

  # 特徵+標籤 00:15 UTC
  - type: cron
    name: features_labels_3d_B
    env: python
    plan: starter
    region: singapore
    schedule: "15 0 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: DAYS=3 python -m src.cli.build_features_labels
    envVars:
      - key: SUPABASE_DB_URL
        sync: false
      - key: PYTHON_VERSION
        value: "3.11.9"

  # 特徵+標籤 02:40 UTC
  - type: cron
    name: features_labels_7d
    env: python
    plan: starter
    region: singapore
    schedule: "40 2 * * *"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: DAYS=7 python -m src.cli.build_features_labels
    envVars:
      - key: SUPABASE_DB_URL
        sync: false
      - key: PYTHON_VERSION
        value: "3.11.9"